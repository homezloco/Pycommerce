{% extends 'base.html' %}

{% block title %}{{ tenant.name }} - PyCommerce Store{% endblock %}

{% block content %}
{% if theme and theme.header_style %}
    {% if theme.header_style == 'minimal' %}
    <header class="store-header py-3" style="background-color: var(--theme-primary-color, var(--bs-dark));">
        <div class="container">
            <div class="d-flex justify-content-{% if theme.logo_position == 'center' %}center{% elif theme.logo_position == 'right' %}end{% else %}start{% endif %} align-items-center">
                {% if theme.logo_url %}
                <div style="max-width: 200px; max-height: 80px;">
                    <img src="{{ theme.logo_url }}" alt="{{ tenant.name }} Logo" style="max-width: 100%; max-height: 100%; object-fit: contain;">
                </div>
                {% else %}
                <h1 class="h3 mb-0">{{ tenant.name }}</h1>
                {% endif %}
            </div>
        </div>
    </header>
    {% elif theme.header_style == 'centered' %}
    <header class="store-header py-4" style="background-color: var(--theme-primary-color, var(--bs-dark));">
        <div class="container text-center">
            {% if theme.logo_url %}
            <div class="mb-3 {% if theme.logo_position == 'center' %}mx-auto{% elif theme.logo_position == 'right' %}ms-auto me-0{% else %}ms-0 me-auto{% endif %}" style="max-width: 250px; max-height: 100px;">
                <img src="{{ theme.logo_url }}" alt="{{ tenant.name }} Logo" style="max-width: 100%; max-height: 100%; object-fit: contain;">
            </div>
            {% else %}
            <h1 class="display-3">{{ tenant.name }}</h1>
            {% endif %}
            <p class="lead">Welcome to our store</p>
            <hr class="my-4" style="background-color: var(--theme-secondary-color, var(--bs-light)); opacity: 0.25;">
            <p class="mb-0">Discover our amazing products</p>
        </div>
    </header>
    {% elif theme.header_style == 'expanded' %}
    <header class="store-header py-5" style="background-color: var(--theme-primary-color, var(--bs-dark));">
        <div class="container text-center">
            {% if theme.logo_url %}
            <div class="mb-4 {% if theme.logo_position == 'center' %}mx-auto{% elif theme.logo_position == 'right' %}ms-auto me-0{% else %}ms-0 me-auto{% endif %}" style="max-width: 300px; max-height: 120px;">
                <img src="{{ theme.logo_url }}" alt="{{ tenant.name }} Logo" style="max-width: 100%; max-height: 100%; object-fit: contain;">
            </div>
            {% else %}
            <h1 class="display-2">{{ tenant.name }}</h1>
            {% endif %}
            <p class="lead">Welcome to our online store</p>
            <p class="mb-4">Discover the best products at the best prices</p>
            <div class="d-grid gap-2 d-sm-flex justify-content-sm-center">
                <a href="#products" class="btn btn-outline-light px-4 py-2">Browse Products</a>
                <a href="/cart" class="btn btn-light px-4 py-2">View Cart</a>
            </div>
        </div>
    </header>
    {% else %}
    <header class="store-header" style="background-color: var(--theme-primary-color, var(--bs-dark));">
        <div class="container text-center">
            {% if theme.logo_url %}
            <div class="mb-3 {% if theme.logo_position == 'center' %}mx-auto{% elif theme.logo_position == 'right' %}ms-auto me-0{% else %}ms-0 me-auto{% endif %}" style="max-width: 250px; max-height: 100px;">
                <img src="{{ theme.logo_url }}" alt="{{ tenant.name }} Logo" style="max-width: 100%; max-height: 100%; object-fit: contain;">
            </div>
            {% else %}
            <h1 class="display-4">{{ tenant.name }}</h1>
            {% endif %}
            <p class="lead">Welcome to our store</p>
        </div>
    </header>
    {% endif %}
{% else %}
    <header class="store-header">
        <div class="container text-center">
            <h1 class="display-4">{{ tenant.name }}</h1>
            <p class="lead">Welcome to our store</p>
        </div>
    </header>
{% endif %}

<div class="container">
    <div class="row mb-4">
        <div class="col-md-8 mx-auto">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Filter Products</h5>
                    <form method="get" action="/store/{{ tenant.slug }}" class="row g-3">
                        <div class="col-md-4">
                            <label for="category" class="form-label">Category</label>
                            <input type="text" class="form-control" id="category" name="category" value="{{ filters.category|default('') }}">
                        </div>
                        
                        <div class="col-md-3">
                            <label for="min_price" class="form-label">Min Price</label>
                            <input type="number" class="form-control" id="min_price" name="min_price" min="0" step="0.01" value="{{ filters.min_price|default('') }}">
                        </div>
                        
                        <div class="col-md-3">
                            <label for="max_price" class="form-label">Max Price</label>
                            <input type="number" class="form-control" id="max_price" name="max_price" min="0" step="0.01" value="{{ filters.max_price|default('') }}">
                        </div>
                        
                        <div class="col-md-2 d-flex align-items-end">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="in_stock" name="in_stock" value="true" {% if filters.in_stock %}checked{% endif %}>
                                <label class="form-check-label" for="in_stock">
                                    In Stock
                                </label>
                            </div>
                        </div>
                        
                        <div class="col-12 text-end">
                            <button type="submit" class="btn btn-primary">Apply Filters</button>
                            <a href="/store/{{ tenant.slug }}" class="btn btn-secondary">Clear Filters</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="row row-cols-1 row-cols-md-3 g-4">
        {% for product in products %}
        <div class="col">
            <div class="card product-card shadow-sm h-100">
                <div class="card-body">
                    <h5 class="card-title">{{ product.name }}</h5>
                    <p class="card-text">{{ product.description }}</p>
                    <p class="fw-bold text-primary">${{ "%.2f"|format(product.price) }}</p>
                    <p>
                        <small class="text-muted">SKU: {{ product.sku }}</small><br>
                        <small class="text-muted">Stock: {{ product.stock }}</small>
                    </p>
                    {% if product.categories %}
                    <div class="mb-2">
                        {% for category in product.categories %}
                        <span class="badge bg-secondary me-1">{{ category }}</span>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
                <div class="card-footer bg-transparent">
                    <form method="post" action="/cart/add" class="d-flex">
                        <input type="hidden" name="product_id" value="{{ product.id }}">
                        <input type="number" name="quantity" value="1" min="1" max="100" class="form-control me-2" style="width: 70px;">
                        <button type="submit" class="btn btn-outline-primary flex-grow-1">Add to Cart</button>
                    </form>
                </div>
            </div>
        </div>
        {% else %}
        <div class="col-12 text-center">
            <div class="alert alert-info">
                <p>No products found for this store.</p>
                {% if filters.category or filters.min_price or filters.max_price or filters.in_stock %}
                <p>Try adjusting your filters or <a href="/store/{{ tenant.slug }}">clear all filters</a>.</p>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}