{% extends 'base.html' %}

{% block title %}PyCommerce - Products{% endblock %}

{% block content %}
<div class="container">
    <div class="text-center my-5">
        <h1 class="display-4">Products</h1>
        <p class="lead">Browse products from our demo stores</p>
    </div>

    <div class="row mb-4">
        <div class="col-md-6 mx-auto">
            <div class="card tenant-selector">
                <div class="card-body">
                    <h5 class="card-title">Select Store</h5>
                    <form method="get" action="/products" class="d-flex">
                        <select name="tenant" class="form-select me-2" aria-label="Select Store">
                            <option value="">All Stores</option>
                            {% for tenant in tenants %}
                            <option value="{{ tenant.slug }}" {% if selected_tenant == tenant.slug %}selected{% endif %}>
                                {{ tenant.name }}
                            </option>
                            {% endfor %}
                        </select>
                        <button type="submit" class="btn btn-primary">View</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-md-8 mx-auto">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Filter Products</h5>
                    <form method="get" action="/products" class="row g-3">
                        {% if selected_tenant %}
                        <input type="hidden" name="tenant" value="{{ selected_tenant }}">
                        {% endif %}
                        
                        <div class="col-md-4">
                            <label for="category" class="form-label">Category</label>
                            <input type="text" class="form-control" id="category" name="category" value="{{ filters.category|default('') }}">
                        </div>
                        
                        <div class="col-md-3">
                            <label for="min_price" class="form-label">Min Price</label>
                            <input type="number" class="form-control" id="min_price" name="min_price" min="0" step="0.01" value="{{ filters.min_price|default('') }}">
                        </div>
                        
                        <div class="col-md-3">
                            <label for="max_price" class="form-label">Max Price</label>
                            <input type="number" class="form-control" id="max_price" name="max_price" min="0" step="0.01" value="{{ filters.max_price|default('') }}">
                        </div>
                        
                        <div class="col-md-2 d-flex align-items-end">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="in_stock" name="in_stock" value="true" {% if filters.in_stock %}checked{% endif %}>
                                <label class="form-check-label" for="in_stock">
                                    In Stock
                                </label>
                            </div>
                        </div>
                        
                        <div class="col-12 text-end">
                            <button type="submit" class="btn btn-primary">Apply Filters</button>
                            <a href="/products{% if selected_tenant %}?tenant={{ selected_tenant }}{% endif %}" class="btn btn-secondary">Clear Filters</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="row row-cols-1 row-cols-md-3 g-4">
        {% for product in products %}
        <div class="col">
            <div class="card product-card shadow-sm h-100">
                <div class="card-body">
                    <h5 class="card-title">{{ product.name }}</h5>
                    <p class="card-text">{{ product.description }}</p>
                    <p class="fw-bold text-primary">${{ "%.2f"|format(product.price) }}</p>
                    <p>
                        <small class="text-muted">SKU: {{ product.sku }}</small><br>
                        <small class="text-muted">Stock: {{ product.stock }}</small>
                    </p>
                    {% if product.categories %}
                    <div class="mb-2">
                        {% for category in product.categories %}
                        <span class="badge bg-secondary me-1">{{ category }}</span>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
                <div class="card-footer bg-transparent">
                    <form method="post" action="/cart/add" class="d-flex">
                        <input type="hidden" name="product_id" value="{{ product.id }}">
                        <input type="number" name="quantity" value="1" min="1" max="100" class="form-control me-2" style="width: 70px;">
                        <button type="submit" class="btn btn-outline-primary flex-grow-1">Add to Cart</button>
                    </form>
                </div>
            </div>
        </div>
        {% else %}
        <div class="col-12 text-center">
            <div class="alert alert-info">
                <p>No products found.</p>
                {% if filters.category or filters.min_price or filters.max_price or filters.in_stock %}
                <p>Try adjusting your filters or <a href="/products{% if selected_tenant %}?tenant={{ selected_tenant }}{% endif %}">clear all filters</a>.</p>
                {% else %}
                <p>Generate sample data first.</p>
                <a href="/api/generate-sample-data" class="btn btn-info">Generate Demo Data</a>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}