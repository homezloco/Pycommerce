{% extends "admin/base_admin.html" %}

{% block title %}Page Templates - PyCommerce Admin{% endblock %}

{% block dashboard_content %}
<div class="container-fluid px-4">
    <h1 class="mt-4">Page Templates</h1>
    <ol class="breadcrumb mb-4">
        <li class="breadcrumb-item"><a href="/admin">Dashboard</a></li>
        <li class="breadcrumb-item"><a href="/admin/pages{% if selected_tenant %}?tenant={{ selected_tenant }}{% endif %}">Pages</a></li>
        <li class="breadcrumb-item active">Templates</li>
    </ol>

    {% if status_message %}
    <div class="alert alert-{{ status_type }}" role="alert">
        {{ status_message }}
    </div>
    {% endif %}

    <div class="card mb-4">
        <div class="card-header">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <i class="fas fa-file-alt me-1"></i>
                    Page Templates
                </div>
                <div>
                    <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#createTemplateModal">
                        <i class="fas fa-plus-circle me-1"></i> Create Template
                    </button>
                </div>
            </div>
        </div>
        <div class="card-body">
            {% if templates %}
                <div class="row">
                    {% for template in templates %}
                    <div class="col-md-4 mb-4">
                        <div class="card h-100">
                            <div class="card-header">
                                <h5 class="card-title mb-0">{{ template.name }}</h5>
                            </div>
                            <div class="card-body">
                                <p class="card-text text-muted">{{ template.description or 'No description available' }}</p>
                                
                                <div class="d-flex justify-content-between align-items-center mt-3">
                                    <span class="badge bg-secondary">{{ template.category or 'General' }}</span>
                                    <small class="text-muted">{{ template.created_at }}</small>
                                </div>
                            </div>
                            <div class="card-footer bg-transparent d-flex justify-content-end">
                                <a href="/admin/pages/create?template={{ template.id }}{% if selected_tenant %}&tenant={{ selected_tenant }}{% endif %}" class="btn btn-outline-primary btn-sm me-2">
                                    <i class="fas fa-plus-circle me-1"></i> Use Template
                                </a>
                                <button type="button" class="btn btn-outline-secondary btn-sm" onclick="viewTemplate('{{ template.id }}')">
                                    <i class="fas fa-eye me-1"></i> Preview
                                </button>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>
                    No page templates found. Create your first template to get started.
                </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Create Template Modal -->
<div class="modal fade" id="createTemplateModal" tabindex="-1" aria-labelledby="createTemplateModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="createTemplateModalLabel">Create Page Template</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="createTemplateForm" method="POST" action="/admin/page-templates/create">
                    <div class="mb-3">
                        <label for="templateName" class="form-label">Template Name</label>
                        <input type="text" class="form-control" id="templateName" name="name" required>
                    </div>
                    <div class="mb-3">
                        <label for="templateDescription" class="form-label">Description</label>
                        <textarea class="form-control" id="templateDescription" name="description" rows="3"></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="templateCategory" class="form-label">Category</label>
                        <select class="form-select" id="templateCategory" name="category">
                            <option value="Landing">Landing Page</option>
                            <option value="Product">Product Page</option>
                            <option value="About">About Page</option>
                            <option value="Contact">Contact Page</option>
                            <option value="General" selected>General</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="existingPageId" class="form-label">Base on Existing Page</label>
                        <select class="form-select" id="existingPageId" name="existing_page_id">
                            <option value="" selected>Create from scratch</option>
                            <!-- This would be populated with existing pages -->
                        </select>
                        <div class="form-text">Optionally use an existing page as the starting point for this template</div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="document.getElementById('createTemplateForm').submit()">Create Template</button>
            </div>
        </div>
    </div>
</div>

<!-- Preview Template Modal -->
<div class="modal fade" id="previewTemplateModal" tabindex="-1" aria-labelledby="previewTemplateModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="previewTemplateModalLabel">Template Preview</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="templatePreviewContent" class="border p-3 bg-light" style="min-height: 400px;">
                    <div class="d-flex justify-content-center align-items-center h-100">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="useTemplateBtn">Use This Template</button>
            </div>
        </div>
    </div>
</div>

<script>
    // Function to view template preview
    function viewTemplate(templateId) {
        const modal = new bootstrap.Modal(document.getElementById('previewTemplateModal'));
        const previewContent = document.getElementById('templatePreviewContent');
        const useTemplateBtn = document.getElementById('useTemplateBtn');
        
        // Show loading state
        previewContent.innerHTML = `
            <div class="d-flex justify-content-center align-items-center h-100">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
            </div>
        `;
        
        // Set up the Use Template button
        useTemplateBtn.onclick = function() {
            window.location.href = `/admin/pages/create?template=${templateId}{% if selected_tenant %}&tenant={{ selected_tenant }}{% endif %}`;
        };
        
        // Fetch template data (in a real implementation)
        setTimeout(() => {
            // This would be replaced with actual API call
            previewContent.innerHTML = `
                <div class="bg-white p-4">
                    <h2>Template Preview</h2>
                    <p class="text-muted">This is a preview of how the template would look when used to create a new page.</p>
                    
                    <hr>
                    
                    <div class="template-section p-3 mb-3 border">
                        <h3>Header Section</h3>
                        <p>This would display your page title and introduction.</p>
                    </div>
                    
                    <div class="template-section p-3 mb-3 border">
                        <h4>Content Section</h4>
                        <p>Main content would go here. This can include text, images, and other components.</p>
                    </div>
                    
                    <div class="template-section p-3 mb-3 border">
                        <h4>Call to Action</h4>
                        <p>A prominent call-to-action button or form would be displayed here.</p>
                    </div>
                </div>
            `;
        }, 1000);
        
        modal.show();
    }
    
    // Populate existing pages in the dropdown (this would be done via API in a real implementation)
    document.addEventListener('DOMContentLoaded', function() {
        // Example code to populate the dropdown - would be replaced with actual API call
        const pageSelect = document.getElementById('existingPageId');
        
        // This is just an example and would be replaced with actual data
        /* 
        fetch('/admin/api/pages')
            .then(response => response.json())
            .then(data => {
                data.pages.forEach(page => {
                    const option = document.createElement('option');
                    option.value = page.id;
                    option.textContent = page.title;
                    pageSelect.appendChild(option);
                });
            });
        */
    });
</script>
{% endblock dashboard_content %}