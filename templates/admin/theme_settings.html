{% extends "admin/base_admin.html" %}

{% block title %}Theme Settings{% endblock %}

{% block content %}
<div class="container-fluid px-4">
    <h1 class="mt-4">Theme Settings</h1>
    <ol class="breadcrumb mb-4">
        <li class="breadcrumb-item"><a href="/admin/dashboard">Dashboard</a></li>
        <li class="breadcrumb-item active">Theme Settings</li>
    </ol>

    {% if status_message %}
    <div class="alert alert-{{ status_type }}" role="alert">
        {{ status_message }}
    </div>
    {% endif %}

    <div class="row">
        <div class="col-lg-8">
            <div class="card mb-4">
                <div class="card-header">
                    <i class="fas fa-palette me-1"></i>
                    Theme Configuration
                </div>
                <div class="card-body">
                    <ul class="nav nav-tabs" id="themeSettingsTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="general-tab" data-bs-toggle="tab" data-bs-target="#general" type="button" role="tab" aria-controls="general" aria-selected="true">General</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="colors-tab" data-bs-toggle="tab" data-bs-target="#colors" type="button" role="tab" aria-controls="colors" aria-selected="false">Colors</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="typography-tab" data-bs-toggle="tab" data-bs-target="#typography" type="button" role="tab" aria-controls="typography" aria-selected="false">Typography</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="header-tab" data-bs-toggle="tab" data-bs-target="#header" type="button" role="tab" aria-controls="header" aria-selected="false">Header</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="footer-tab" data-bs-toggle="tab" data-bs-target="#footer" type="button" role="tab" aria-controls="footer" aria-selected="false">Footer</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="pages-tab" data-bs-toggle="tab" data-bs-target="#pages" type="button" role="tab" aria-controls="pages" aria-selected="false">Pages</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="advanced-tab" data-bs-toggle="tab" data-bs-target="#advanced" type="button" role="tab" aria-controls="advanced" aria-selected="false">Advanced</button>
                        </li>
                    </ul>
                    <div class="tab-content" id="themeSettingsTabsContent">
                        <div class="tab-pane fade show active" id="general" role="tabpanel" aria-labelledby="general-tab">
                            <div class="p-4">
                                <h4>General Settings</h4>
                                <div class="mb-3">
                                    <label for="siteTitle" class="form-label">Site Title</label>
                                    <input type="text" class="form-control" id="siteTitle" name="site_title" value="{{ theme.site_title if theme and theme.site_title else '' }}">
                                </div>
                                <div class="mb-3">
                                    <label for="siteDescription" class="form-label">Site Description</label>
                                    <textarea class="form-control" id="siteDescription" name="site_description" rows="3">{{ theme.site_description if theme and theme.site_description else '' }}</textarea>
                                </div>
                            </div>
                        </div>


                        <div class="tab-pane fade" id="colors" role="tabpanel" aria-labelledby="colors-tab">
                            <div class="p-4">
                                <h4>Color Settings</h4>
                                <div class="mb-3">
                                    <label for="primaryColor" class="form-label">Primary Color</label>
                                    <input type="color" class="form-control form-control-color" id="primaryColor" name="primary_color" value="{{ theme.primary_color if theme and theme.primary_color else '#3498db' }}">
                                </div>
                                <div class="mb-3">
                                    <label for="secondaryColor" class="form-label">Secondary Color</label>
                                    <input type="color" class="form-control form-control-color" id="secondaryColor" name="secondary_color" value="{{ theme.secondary_color if theme and theme.secondary_color else '#6c757d' }}">
                                </div>
                                <div class="mb-3">
                                    <label for="accentColor" class="form-label">Accent Color</label>
                                    <input type="color" class="form-control form-control-color" id="accentColor" name="accent_color" value="{{ theme.accent_color if theme and theme.accent_color else '#ffc107' }}">
                                </div>
                            </div>
                        </div>

                        <div class="tab-pane fade" id="typography" role="tabpanel" aria-labelledby="typography-tab">
                            <div class="p-4">
                                <h4>Typography Settings</h4>
                                <div class="mb-3">
                                    <label for="fontFamily" class="form-label">Font Family</label>
                                    <input type="text" class="form-control" id="fontFamily" name="font_family" value="{{ theme.font_family if theme and theme.font_family else 'Arial, sans-serif' }}">
                                </div>
                                <div class="mb-3">
                                    <label for="fontSize" class="form-label">Font Size</label>
                                    <input type="number" class="form-control" id="fontSize" name="font_size" value="{{ theme.font_size if theme and theme.font_size else 16 }}">
                                </div>
                            </div>
                        </div>

                        <div class="tab-pane fade" id="header" role="tabpanel" aria-labelledby="header-tab">
                            <div class="p-4">
                                <h4>Header Settings</h4>
                                <div class="mb-3">
                                    <label for="headerHeight" class="form-label">Header Height</label>
                                    <input type="number" class="form-control" id="headerHeight" name="header_height" value="{{ theme.header_height if theme and theme.header_height else 60 }}">
                                </div>
                                <div class="mb-3">
                                    <label for="headerBackgroundColor" class="form-label">Header Background Color</label>
                                    <input type="color" class="form-control form-control-color" id="headerBackgroundColor" name="header_background_color" value="{{ theme.header_background_color if theme and theme.header_background_color else '#343a40' }}">
                                </div>
                            </div>
                        </div>

                        <div class="tab-pane fade" id="footer" role="tabpanel" aria-labelledby="footer-tab">
                            <div class="p-4">
                                <h4>Footer Settings</h4>
                                <div class="mb-3">
                                    <label for="footerHeight" class="form-label">Footer Height</label>
                                    <input type="number" class="form-control" id="footerHeight" name="footer_height" value="{{ theme.footer_height if theme and theme.footer_height else 100 }}">
                                </div>
                                <div class="mb-3">
                                    <label for="footerBackgroundColor" class="form-label">Footer Background Color</label>
                                    <input type="color" class="form-control form-control-color" id="footerBackgroundColor" name="footer_background_color" value="{{ theme.footer_background_color if theme and theme.footer_background_color else '#212529' }}">
                                </div>
                            </div>
                        </div>

                        <div class="tab-pane fade" id="pages" role="tabpanel" aria-labelledby="pages-tab">
                            <div class="p-4">
                                <h4>Page Builder Settings</h4>
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle me-2"></i>
                                    Customize the appearance of pages created with the Page Builder.
                                </div>

                                <div class="card mb-4">
                                    <div class="card-header">
                                        <h5 class="mb-0">Page Templates</h5>
                                    </div>
                                    <div class="card-body">
                                        <p>Manage your page templates to quickly create consistent pages:</p>
                                        <a href="/admin/page-templates" class="btn btn-primary">
                                            <i class="fas fa-th-large me-1"></i> Manage Templates
                                        </a>
                                    </div>
                                </div>

                                <div class="card mb-4">
                                    <div class="card-header">
                                        <h5 class="mb-0">Global Section Settings</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label for="defaultSectionPadding" class="form-label">Default Section Padding</label>
                                            <select class="form-select" id="defaultSectionPadding" name="default_section_padding">
                                                <option value="small" {% if theme and theme.default_section_padding == 'small' %}selected{% endif %}>Small (10px)</option>
                                                <option value="medium" {% if not theme or not theme.default_section_padding or theme.default_section_padding == 'medium' %}selected{% endif %}>Medium (30px)</option>
                                                <option value="large" {% if theme and theme.default_section_padding == 'large' %}selected{% endif %}>Large (60px)</option>
                                            </select>
                                        </div>

                                        <div class="mb-3">
                                            <label for="defaultSectionWidth" class="form-label">Default Content Width</label>
                                            <select class="form-select" id="defaultSectionWidth" name="default_section_width">
                                                <option value="narrow" {% if theme and theme.default_section_width == 'narrow' %}selected{% endif %}>Narrow (768px)</option>
                                                <option value="normal" {% if not theme or not theme.default_section_width or theme.default_section_width == 'normal' %}selected{% endif %}>Normal (1140px)</option>
                                                <option value="wide" {% if theme and theme.default_section_width == 'wide' %}selected{% endif %}>Wide (1400px)</option>
                                                <option value="full" {% if theme and theme.default_section_width == 'full' %}selected{% endif %}>Full Width</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="tab-pane fade" id="advanced" role="tabpanel" aria-labelledby="advanced-tab">
                            <div class="p-4">
                                <h4>Advanced Settings</h4>
                                <div class="mb-3">
                                    <label for="customCSS" class="form-label">Custom CSS</label>
                                    <textarea class="form-control" id="customCSS" name="custom_css" rows="6" placeholder="Add your custom CSS here">{{ theme.custom_css if theme and theme.custom_css else '' }}</textarea>
                                    <div class="form-text">Custom CSS will be applied to all pages of your store.</div>
                                </div>
                                <div class="mb-3">
                                    <label for="headerScripts" class="form-label">Header Scripts</label>
                                    <textarea class="form-control" id="headerScripts" name="header_scripts" rows="4" placeholder="Add scripts to be included in the <head> section">{{ theme.header_scripts if theme and theme.header_scripts else '' }}</textarea>
                                    <div class="form-text">Scripts will be added to the &lt;head&gt; section of your pages.</div>
                                </div>
                                <div class="mb-3">
                                    <label for="footerScripts" class="form-label">Footer Scripts</label>
                                    <textarea class="form-control" id="footerScripts" name="footer_scripts" rows="4" placeholder="Add scripts to be included before </body>">{{ theme.footer_scripts if theme and theme.footer_scripts else '' }}</textarea>
                                    <div class="form-text">Scripts will be added just before the closing &lt;/body&gt; tag.</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <div class="card mb-4">
                <div class="card-header">
                    <i class="fas fa-info-circle me-1"></i>
                    Theme Preview
                </div>
                <div class="card-body">
                    <div class="mt-3">
                        <h6>Current Theme Settings:</h6>
                        <ul class="list-group">
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                Primary Color
                                <span class="badge" style="background-color: {{ theme.primary_color if theme and theme.primary_color else '#3498db' }}; width: 30px; height: 30px; border-radius: 50%;"></span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                Secondary Color
                                <span class="badge" style="background-color: {{ theme.secondary_color if theme and theme.secondary_color else '#6c757d' }}; width: 30px; height: 30px; border-radius: 50%;"></span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                Background Color
                                <span class="badge" style="background-color: {{ theme.background_color if theme and theme.background_color else '#ffffff' }}; width: 30px; height: 30px; border-radius: 50%; border: 1px solid #dee2e6;"></span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                Text Color
                                <span class="badge" style="background-color: {{ theme.text_color if theme and theme.text_color else '#212529' }}; width: 30px; height: 30px; border-radius: 50%;"></span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                Font Family
                                <span>{{ theme.font_family if theme and theme.font_family else 'Arial, sans-serif' }}</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                Logo Position
                                <span>{{ theme.logo_position|title if theme and theme.logo_position else 'Left' }}</span>
                            </li>
                        </ul>
                    </div>

                    <div class="theme-preview mt-4 p-3" style="background-color: {{ theme.background_color if theme and theme.background_color else '#ffffff' }}; color: {{ theme.text_color if theme and theme.text_color else '#212529' }}; font-family: {{ theme.font_family if theme and theme.font_family else 'Arial, sans-serif' }}; border: 1px solid #dee2e6; border-radius: 0.25rem;">
                        <div class="text-{{ theme.logo_position if theme and theme.logo_position else 'left' }}">
                            <strong>LOGO</strong>
                        </div>
                        <hr>
                        <h4>Sample Heading</h4>
                        <p>This is an example of how your text will look with the selected font family and colors.</p>
                        <button class="btn btn-sm" style="background-color: {{ theme.primary_color if theme and theme.primary_color else '#3498db' }}; color: #fff;">Primary Button</button>
                        <button class="btn btn-sm" style="background-color: {{ theme.secondary_color if theme and theme.secondary_color else '#6c757d' }}; color: #fff;">Secondary Button</button>
                    </div>
                </div>
            </div>

            <div class="card mb-4">
                <div class="card-header">
                    <i class="fas fa-question-circle me-1"></i>
                    Help
                </div>
                <div class="card-body">
                    <p>Theme settings control the visual appearance of your store. Changes will apply to all storefront pages.</p>
                    <p>For more advanced customization, use the Custom CSS field to add specific styling rules.</p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Preview updates in real-time
    document.addEventListener('DOMContentLoaded', function() {
        const primaryColorInput = document.getElementById('primaryColor');
        const secondaryColorInput = document.getElementById('secondaryColor');
        const backgroundColorInput = document.getElementById('backgroundColor');
        const textColorInput = document.getElementById('textColor');
        const fontFamilyInput = document.getElementById('fontFamily');
        const logoPositionInput = document.getElementById('logoPosition');

        const previewArea = document.querySelector('.theme-preview');
        
        // Only add event listeners if elements exist
        if (primaryColorInput && previewArea) {
            const primaryButton = previewArea.querySelectorAll('.btn')[0];
            const secondaryButton = previewArea.querySelectorAll('.btn')[1];
            const logoPreview = previewArea.querySelector('div:first-child');

            // Update preview elements when inputs change
            primaryColorInput.addEventListener('input', function() {
                if (primaryButton) {
                    primaryButton.style.backgroundColor = this.value;
                    const badge = document.querySelector('.list-group-item:nth-child(1) .badge');
                    if (badge) badge.style.backgroundColor = this.value;
                }
            });

            if (secondaryColorInput && secondaryButton) {
                secondaryColorInput.addEventListener('input', function() {
                    secondaryButton.style.backgroundColor = this.value;
                    const badge = document.querySelector('.list-group-item:nth-child(2) .badge');
                    if (badge) badge.style.backgroundColor = this.value;
                });
            }

            if (backgroundColorInput) {
                backgroundColorInput.addEventListener('input', function() {
                    previewArea.style.backgroundColor = this.value;
                    const badge = document.querySelector('.list-group-item:nth-child(3) .badge');
                    if (badge) badge.style.backgroundColor = this.value;
                });
            }

            if (textColorInput) {
                textColorInput.addEventListener('input', function() {
                    previewArea.style.color = this.value;
                    const badge = document.querySelector('.list-group-item:nth-child(4) .badge');
                    if (badge) badge.style.backgroundColor = this.value;
                });
            }

            if (fontFamilyInput) {
                fontFamilyInput.addEventListener('change', function() {
                    previewArea.style.fontFamily = this.value;
                    const span = document.querySelector('.list-group-item:nth-child(5) span');
                    if (span) span.textContent = this.value;
                });
            }

            if (logoPositionInput && logoPreview) {
                logoPositionInput.addEventListener('change', function() {
                    logoPreview.className = '';
                    logoPreview.classList.add('text-' + this.value);
                    const span = document.querySelector('.list-group-item:nth-child(6) span');
                    if (span && this.options && this.selectedIndex >= 0) {
                        span.textContent = this.options[this.selectedIndex].text;
                    }
                });
            }
        }
    });
</script>
{% endblock %}