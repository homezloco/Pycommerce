<!-- AI Assistant Modal -->
<div class="modal fade" id="aiAssistModal" tabindex="-1" aria-labelledby="aiAssistModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="aiAssistModalLabel">AI Content Assistant</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="aiPromptForm">
          <div class="mb-3">
            <label for="aiPrompt" class="form-label">What would you like to generate?</label>
            <textarea class="form-control" id="aiPrompt" rows="3" placeholder="E.g., Write a paragraph about our product features"></textarea>
          </div>
          <div class="row mb-3">
            <div class="col-md-6">
              <label for="aiStyle" class="form-label">Style</label>
              <select class="form-select" id="aiStyle">
                <option value="informative">Informative</option>
                <option value="persuasive">Persuasive</option>
                <option value="casual">Casual</option>
                <option value="formal">Formal</option>
                <option value="enthusiastic">Enthusiastic</option>
              </select>
            </div>
            <div class="col-md-6">
              <label for="aiLength" class="form-label">Length</label>
              <select class="form-select" id="aiLength">
                <option value="short">Short</option>
                <option value="medium" selected>Medium</option>
                <option value="long">Long</option>
              </select>
            </div>
          </div>
        </form>

        <!-- Loading indicator -->
        <div id="aiLoading" class="text-center py-4 d-none">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
          <p class="mt-2">Generating content...</p>
        </div>

        <!-- Result display -->
        <div id="aiResult" class="d-none mt-3">
          <div class="alert alert-primary">
            <h6>Generated Content:</h6>
            <div id="aiContent" class="mt-2"></div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" id="generateAiContentBtn">Generate</button>
        <button type="button" class="btn btn-success d-none" id="useAiContentBtn">Use This Content</button>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Get modal elements
    const generateBtn = document.getElementById('generateAiContentBtn');
    const useBtn = document.getElementById('useAiContentBtn');
    const loadingIndicator = document.getElementById('aiLoading');
    const resultContainer = document.getElementById('aiResult');
    const contentContainer = document.getElementById('aiContent');

    // Generate button click handler
    if (generateBtn) {
      generateBtn.addEventListener('click', function() {
        // Get prompt and options
        const prompt = document.getElementById('aiPrompt').value;
        const style = document.getElementById('aiStyle').value;
        const length = document.getElementById('aiLength').value;

        if (!prompt) {
          alert('Please enter a prompt first');
          return;
        }

        // Show loading, hide result
        loadingIndicator.classList.remove('d-none');
        resultContainer.classList.add('d-none');
        generateBtn.disabled = true;

        // Make API request
        fetch('/admin/api/ai/generate-content', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            prompt: prompt,
            style: style,
            length: length
          })
        })
        .then(response => response.json())
        .then(data => {
          // Hide loading
          loadingIndicator.classList.add('d-none');
          generateBtn.disabled = false;

          if (data.success) {
            // Show result and use button
            contentContainer.innerHTML = data.content;
            resultContainer.classList.remove('d-none');
            useBtn.classList.remove('d-none');
          } else {
            alert('Error generating content: ' + (data.error || 'Unknown error'));
          }
        })
        .catch(error => {
          // Handle errors
          loadingIndicator.classList.add('d-none');
          generateBtn.disabled = false;
          alert('Error: ' + error.message);
          console.error('Error generating content:', error);
        });
      });
    }

    // Use content button click handler
    if (useBtn) {
      useBtn.addEventListener('click', function() {
        const content = contentContainer.innerHTML;

        // Check if we have an active editor
        let inserted = false;

        // Try to insert into Quill editor if one is active
        if (typeof Quill !== 'undefined') {
          const activeEditor = document.querySelector('.ql-editor');
          if (activeEditor) {
            const quill = Quill.find(activeEditor);
            if (quill) {
              quill.clipboard.dangerouslyPasteHTML(quill.getLength(), content);
              inserted = true;
            }
          }
        }

        // Try to insert into TinyMCE if it exists
        if (!inserted && typeof tinymce !== 'undefined') {
          const activeTinyMCE = tinymce.activeEditor;
          if (activeTinyMCE) {
            activeTinyMCE.insertContent(content);
            inserted = true;
          }
        }

        // If no editor was found, copy to clipboard
        if (!inserted) {
          // Create temporary element to copy from
          const tempElement = document.createElement('div');
          tempElement.innerHTML = content;
          document.body.appendChild(tempElement);

          // Select and copy content
          const range = document.createRange();
          range.selectNodeContents(tempElement);
          const selection = window.getSelection();
          selection.removeAllRanges();
          selection.addRange(range);
          document.execCommand('copy');

          // Clean up
          selection.removeAllRanges();
          document.body.removeChild(tempElement);

          alert('Content copied to clipboard');
        }

        // Close the modal
        const modal = bootstrap.Modal.getInstance(document.getElementById('aiAssistModal'));
        if (modal) {
          modal.hide();
        }
      });
    }
  });
</script>