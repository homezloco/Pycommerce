{% extends 'admin/base_admin.html' %}

{% block title %}PyCommerce - Store Settings{% endblock %}

{% block admin_content %}
<div class="container-fluid">
    <h1 class="h2 mb-4">Store Settings</h1>

    <ul class="nav nav-tabs" id="myTab" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link {% if tab == 'basic' or not tab %}active{% endif %}" id="basic-tab" data-bs-toggle="tab" data-bs-target="#basic-pane" type="button" role="tab" aria-controls="basic-pane" aria-selected="{% if tab == 'basic' or not tab %}true{% else %}false{% endif %}">
                Basic Settings
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link {% if tab == 'shipping' %}active{% endif %}" id="shipping-tab" data-bs-toggle="tab" data-bs-target="#shipping-pane" type="button" role="tab" aria-controls="shipping-pane" aria-selected="{% if tab == 'shipping' %}true{% else %}false{% endif %}">
                Shipping
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link {% if tab == 'ai' %}active{% endif %}" id="ai-tab" data-bs-toggle="tab" data-bs-target="#ai-pane" type="button" role="tab" aria-controls="ai-pane" aria-selected="{% if tab == 'ai' %}true{% else %}false{% endif %}">
                AI Configuration
            </button>
        </li>
    </ul>

    <div class="tab-content pt-4" id="myTabContent">
        <!-- Basic Settings Tab -->
        <div class="tab-pane fade {% if tab == 'basic' or not tab %}show active{% endif %}" id="basic-pane" role="tabpanel" aria-labelledby="basic-tab">
            <div class="row">
                <div class="col-md-12">
                    <div class="card shadow-sm mb-4">
                        <div class="card-header">
                            <h5 class="card-title mb-0">Basic Store Settings</h5>
                        </div>
                        <div class="card-body">
                            <p class="text-muted mb-4">
                                Configure your store's basic information and settings.
                            </p>

                            <form action="/admin/store-settings" method="POST" id="basic-settings-form">
                                <input type="hidden" name="tab" value="basic">
                                <div class="mb-3">
                                    <label for="store_name" class="form-label">Store Name</label>
                                    <input type="text" class="form-control" id="store_name" name="store_name" value="{{ config.store_name if config and config.store_name else '' }}">
                                </div>
                                <div class="mb-3">
                                    <label for="store_description" class="form-label">Store Description</label>
                                    <textarea class="form-control" id="store_description" name="store_description" rows="3">{{ config.store_description if config and config.store_description else '' }}</textarea>
                                </div>
                                <div class="mb-3">
                                    <label for="contact_email" class="form-label">Contact Email</label>
                                    <input type="email" class="form-control" id="contact_email" name="contact_email" value="{{ config.contact_email if config and config.contact_email else '' }}">
                                </div>
                                <div class="mb-3">
                                    <label for="currency" class="form-label">Currency</label>
                                    <select class="form-select" id="currency" name="currency">
                                        <option value="USD" {% if config and config.currency == 'USD' %}selected{% endif %}>US Dollar (USD)</option>
                                        <option value="EUR" {% if config and config.currency == 'EUR' %}selected{% endif %}>Euro (EUR)</option>
                                        <option value="GBP" {% if config and config.currency == 'GBP' %}selected{% endif %}>British Pound (GBP)</option>
                                        <option value="CAD" {% if config and config.currency == 'CAD' %}selected{% endif %}>Canadian Dollar (CAD)</option>
                                        <option value="AUD" {% if config and config.currency == 'AUD' %}selected{% endif %}>Australian Dollar (AUD)</option>
                                    </select>
                                </div>
                                <div class="d-flex justify-content-end">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="bi bi-save me-2"></i> Save Settings
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Shipping Configuration Tab -->
        <div class="tab-pane fade {% if tab == 'shipping' %}show active{% endif %}" id="shipping-pane" role="tabpanel" aria-labelledby="shipping-tab">
            <div class="row">
                <div class="col-md-12">
                    <div class="card shadow-sm mb-4">
                        <div class="card-header">
                            <h5 class="card-title mb-0">Shipping Configuration</h5>
                        </div>
                        <div class="card-body">
                            <p class="text-muted mb-4">
                                Configure your store's shipping options and rates. These settings determine how shipping costs are calculated for your customers.
                            </p>

                            <form action="/admin/shipping-settings" method="POST" id="shipping-settings-form">
                                <input type="hidden" name="tab" value="shipping">
                                <div class="row mb-4">
                                    <div class="col-md-6">
                                        <h6 class="fw-bold mb-3">Basic Settings</h6>

                                        <div class="mb-3">
                                            <label for="store_country" class="form-label">Store Country</label>
                                            <select class="form-select" id="store_country" name="store_country">
                                                <option value="US" {% if config and config.store_country == 'US' %}selected{% endif %}>United States</option>
                                                <option value="CA" {% if config and config.store_country == 'CA' %}selected{% endif %}>Canada</option>
                                                <option value="GB" {% if config and config.store_country == 'GB' %}selected{% endif %}>United Kingdom</option>
                                                <option value="AU" {% if config and config.store_country == 'AU' %}selected{% endif %}>Australia</option>
                                                <option value="DE" {% if config and config.store_country == 'DE' %}selected{% endif %}>Germany</option>
                                                <option value="FR" {% if config and config.store_country == 'FR' %}selected{% endif %}>France</option>
                                            </select>
                                            <div class="form-text">The country where your store is located.</div>
                                        </div>

                                        <div class="mb-3">
                                            <label for="store_postal_code" class="form-label">Store Postal/ZIP Code</label>
                                            <input type="text" class="form-control" id="store_postal_code" name="store_postal_code" value="{{ config.store_postal_code if config and config.store_postal_code else '' }}">
                                            <div class="form-text">Used for distance calculations.</div>
                                        </div>

                                        <div class="mb-3">
                                            <label for="free_shipping_threshold" class="form-label">Free Shipping Threshold</label>
                                            <div class="input-group">
                                                <span class="input-group-text">$</span>
                                                <input type="number" class="form-control" id="free_shipping_threshold" name="free_shipping_threshold" value="{{ config.free_shipping_threshold if config and config.free_shipping_threshold else 0 }}" step="0.01" min="0">
                                            </div>
                                            <div class="form-text">Orders above this amount qualify for free shipping. Set to 0 to disable.</div>
                                        </div>
                                    </div>

                                    <div class="col-md-6">
                                        <h6 class="fw-bold mb-3">Advanced Settings</h6>

                                        <div class="mb-3">
                                            <label for="dimensional_weight_factor" class="form-label">Dimensional Weight Factor</label>
                                            <input type="number" class="form-control" id="dimensional_weight_factor" name="dimensional_weight_factor" value="{{ config.dimensional_weight_factor if config and config.dimensional_weight_factor else 5000 }}" step="1" min="1">
                                            <div class="form-text">Conversion factor for calculating dimensional weight (kg/mÂ³).</div>
                                        </div>

                                        <div class="mb-3">
                                            <label for="express_multiplier" class="form-label">Express Shipping Multiplier</label>
                                            <input type="number" class="form-control" id="express_multiplier" name="express_multiplier" value="{{ config.express_multiplier if config and config.express_multiplier else 1.75 }}" step="0.01" min="1">
                                            <div class="form-text">Multiplier for express shipping rates (e.g., 1.75 = 75% more than standard).</div>
                                        </div>

                                        <!-- Add these fields for backwards compatibility -->
                                        <input type="hidden" name="flat_rate_domestic" value="{{ config.flat_rate_domestic if config and config.flat_rate_domestic else 5.00 }}">
                                        <input type="hidden" name="flat_rate_international" value="{{ config.flat_rate_international if config and config.flat_rate_international else 15.00 }}">
                                    </div>
                                </div>

                                <div class="d-flex justify-content-end">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="bi bi-save me-2"></i> Save Settings
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- AI Configuration Tab -->
        <div class="tab-pane fade {% if tab == 'ai' %}show active{% endif %}" id="ai-pane" role="tabpanel" aria-labelledby="ai-tab">
            <div class="row">
                <div class="col-md-12">
                    <div class="card shadow-sm mb-4">
                        <div class="card-header">
                            <h5 class="card-title mb-0">AI Integration Settings</h5>
                        </div>
                        <div class="card-body">
                            <p class="text-muted mb-4">
                                Configure AI provider settings for your store. These settings determine how AI features work in your store, including product descriptions, image generation, and customer support.
                            </p>

                            <form action="/admin/ai-settings" method="POST" id="ai-settings-form">
                                <input type="hidden" name="tab" value="ai">
                                <div class="mb-4">
                                    <h6 class="fw-bold mb-3">OpenAI Configuration</h6>

                                    <div class="mb-3">
                                        <label for="openai_api_key" class="form-label">OpenAI API Key</label>
                                        <input type="password" class="form-control" id="openai_api_key" name="openai_api_key" value="{{ config.openai_api_key if config and config.openai_api_key else '' }}">
                                        <div class="form-text">Your OpenAI API key for text and image generation features.</div>
                                    </div>

                                    <div class="mb-3">
                                        <label for="openai_model" class="form-label">Default Text Model</label>
                                        <select class="form-select" id="openai_model" name="openai_model">
                                            <option value="gpt-4" {% if config and config.openai_model == 'gpt-4' %}selected{% endif %}>GPT-4 (Most Powerful)</option>
                                            <option value="gpt-3.5-turbo" {% if config and config.openai_model == 'gpt-3.5-turbo' %}selected{% endif %}>GPT-3.5 Turbo (Fast & Efficient)</option>
                                        </select>
                                        <div class="form-text">The OpenAI model to use for text generation.</div>
                                    </div>

                                    <div class="mb-3">
                                        <label for="dalle_model" class="form-label">Default Image Model</label>
                                        <select class="form-select" id="dalle_model" name="dalle_model">
                                            <option value="dall-e-3" {% if config and config.dalle_model == 'dall-e-3' %}selected{% endif %}>DALL-E 3 (Highest Quality)</option>
                                            <option value="dall-e-2" {% if config and config.dalle_model == 'dall-e-2' %}selected{% endif %}>DALL-E 2 (Faster)</option>
                                        </select>
                                        <div class="form-text">The model to use for image generation.</div>
                                    </div>
                                </div>

                                <div class="mb-4">
                                    <h6 class="fw-bold mb-3">AI Feature Configuration</h6>

                                    <div class="form-check form-switch mb-3">
                                        <input class="form-check-input" type="checkbox" id="enable_product_descriptions" name="enable_product_descriptions" {% if config and config.enable_product_descriptions %}checked{% endif %}>
                                        <label class="form-check-label" for="enable_product_descriptions">Enable AI Product Descriptions</label>
                                        <div class="form-text">Automatically generate product descriptions when creating new products.</div>
                                    </div>

                                    <div class="form-check form-switch mb-3">
                                        <input class="form-check-input" type="checkbox" id="enable_image_generation" name="enable_image_generation" {% if config and config.enable_image_generation %}checked{% endif %}>
                                        <label class="form-check-label" for="enable_image_generation">Enable AI Image Generation</label>
                                        <div class="form-text">Allow generation of product images using AI.</div>
                                    </div>

                                    <div class="form-check form-switch mb-3">
                                        <input class="form-check-input" type="checkbox" id="enable_chatbot" name="enable_chatbot" {% if config and config.enable_chatbot %}checked{% endif %}>
                                        <label class="form-check-label" for="enable_chatbot">Enable AI Customer Support</label>
                                        <div class="form-text">Add an AI-powered chatbot to your store for customer support.</div>
                                    </div>
                                </div>

                                <div class="d-flex justify-content-end">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="bi bi-save me-2"></i> Save AI Settings
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('Store settings page loaded');
});
</script>
{% endblock %}